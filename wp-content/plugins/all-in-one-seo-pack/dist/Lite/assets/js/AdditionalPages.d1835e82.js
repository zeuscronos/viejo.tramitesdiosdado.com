import{e as E,a as z,k as J}from"./index.4b887428.js";import{u as W}from"./WpTable.f051f458.js";import{F,P as O}from"./constants.bc5863fe.js";import{d as j,a as H}from"./date.f7db1924.js";import{D as I}from"./datetime.f197aeae.js";import"./translations.e71e2202.js";import{p as A,k as K,n as q}from"./helpers.633a054c.js";import{u as Q}from"./Url.9f0afcb2.js";import{B as G}from"./DatePicker.36e9e18f.js";import{C as X}from"./Index.2a391835.js";import{C as Y}from"./Index.25ae8dfb.js";import{a as Z,S as $}from"./Pencil.d82df6a1.js";import{S as ee}from"./Exclamation.fc507dc9.js";import{a as L}from"./runtime-dom.esm-bundler.dc49ee3e.js";import{_ as B}from"./_plugin-vue_export-helper.eefbdd86.js";import{_ as o,a as N}from"./default-i18n.65d58dd6.js";import{a6 as m,o as P,c as U,_ as l,$ as n,a4 as y,l as u,a2 as d,F as se,a1 as b,ae as V,a7 as h}from"./runtime-core.esm-bundler.ce5add0b.js";import{C as te}from"./Table.5d523def.js";import{C as ie}from"./Card.597c7ae2.js";import{C as oe}from"./Tooltip.23c7170d.js";import{_ as ae}from"./Trash.87a7d946.js";import"./ScrollTo.81bea8a7.js";import"./Calendar.9a717949.js";import"./pick.25b3ec2e.js";import"./_getTag.6fb74b2e.js";import"./debounce.652fa24c.js";import"./toNumber.ad9dffac.js";import"./isEqual.59768dc1.js";import"./_baseIsEqual.c0ca09f7.js";import"./Close.ccd53ef3.js";import"./numbers.cdba2587.js";import"./Button.9a301412.js";import"./Slide.3003ef51.js";import"./Download.aa34559d.js";import"./Caret.cd869c5d.js";const le=""+window.__aioseoDynamicImportPreload__("images/import-from-csv.ecb34312.png"),c="all-in-one-seo-pack",x={page:{url:null,priority:{label:"0.7",value:"0.7"},frequency:{label:o("weekly","all-in-one-seo-pack"),value:"weekly"},lastModified:I.now().toFormat("MM/dd/yyyy")}},re={emits:["cancel","process-page-add-and-update","process-page-edit"],setup(){const{decodeUrl:t}=Q();return{FREQUENCY_OPTIONS:F,PRIORITY_OPTIONS:O,dateJsToLocal:j,dateStringToLocalJs:H,decodeUrl:t,optionsStore:E(),rootStore:z()}},components:{BaseDatePicker:G,CoreAlert:X,CoreModal:Y,SvgCircleCheck:Z,SvgCircleClose:$,SvgCircleExclamation:ee},props:{inTable:Boolean,row:Object,index:Number,getPaginatedIndex:Function,getParsedPages:Function,rowPage:{type:Object,default(){return{}}},editedPage:{type:Object,default(){return{}}}},data(){return{csvFileImage:le,priorityOptionsValues:[],frequencyOptionsValues:[],filename:"",file:"",loading:!1,showImportModal:!1,page:A(x.page),errors:{url:{invalid:null,exists:null},upload:!1},isLoading:!1,strings:{placeholder:N(o("Enter a page URL, e.g. %1$s",c),`${this.rootStore.aioseo.urls.home}/new-page`),pageUrl:o("Page URL",c),priority:o("Priority",c),frequency:o("Frequency",c),lastModified:o("Last Modified",c),addPage:o("Add Page",c),importFromCSV:o("Import from CSV",c),saveChanges:o("Update Page",c),cancel:o("Cancel",c),importAdditionalPages:o("Import Additional Pages",c),modalDescription:N(o("You can import additional page URL's to your sitemap using a CSV file. The following 4 columns are required: %1$sPage URL, Priority, Frequency, Date Modified.%2$s",c),"<strong>","</strong>"),downloadSampleFile:o("Download Sample CSV File",c),imgAltText:o("CSV example file",c),fileUploadPlaceholder:o("Import from CSV file...",c),chooseAFile:o("Choose a File",c),import:o("Import",c),csvFileTypeRequired:o("The file that you've currently selected is not a CSV file.",c),invalidCSV:o("Unable to read CSV file. Please check if the file is valid and try again.",c),errors:{url:{invalid:o("Please enter a valid URL.",c),exists:o("URL already exists.",c)}}},sampleCSVData:`Page URL,Priority,Frequency,Date Modified\r
https://aioseo.com/pricing/,0.0,weekly,01/30/2022`}},computed:{importValidated(){return this.file.type==="text/csv"}},methods:{getAssetUrl:K,updateAdditionalPages(t){this.optionsStore.options.sitemap.general.additionalPages.pages=t},addPage(){const t=this.optionsStore.options.sitemap.general.additionalPages.pages;t.unshift(JSON.stringify(this.page)),this.updateAdditionalPages(t),this.page=A(x.page),this.errors.url.invalid=null,this.$emit("process-page-add-and-update")},editPage(t,s){if(this.page[t]=s,!q(this.page.url)&&this.page.url){this.errors.url.invalid=!0;return}if(this.pageExists(this.page.url)&&!this.inTable){this.errors.url.invalid=!1,this.errors.url.exists=!0;return}this.errors.url.invalid=!1,this.errors.url.exists=!1,this.inTable&&this.$emit("process-page-edit",this.page)},updateUrl(t){this.page.url="",this.page.url=this.decodeUrl(t)},updatePage(t){const s=this.optionsStore.options.sitemap.general.additionalPages.pages;s[this.getPaginatedIndex(t)]=JSON.stringify(this.page),this.updateAdditionalPages(s),this.$emit("process-page-add-and-update"),this.$emit("cancel",!0)},pageExists(t){return this.getParsedPages().some(({url:s})=>s===t)},findPageIndex(t){return this.getParsedPages().findIndex(({url:s})=>s===t)},reset(){this.errors.upload=!1,this.filename="",this.file=""},triggerFileUpload(){this.reset(),this.$refs.file.$el.querySelector("input").focus(),this.$refs.file.$el.querySelector("input").click()},async submitFile(){this.loading=!0;try{const t=await this.parseFile(),s=this.optionsStore.options.sitemap.general.additionalPages.pages;t.forEach(r=>{const a=this.prepareAdditionalPage(r);if(a)if(this.pageExists(a.url)){const e=this.findPageIndex(a.url);s[e]=JSON.stringify(a)}else s.unshift(JSON.stringify(a))}),this.updateAdditionalPages(s)}catch{this.errors.upload=this.strings.invalidCSV}this.reset(),this.page=A(x.page),this.showImportModal=!1,this.loading=!1},prepareAdditionalPage(t){const s=A(x.page),r=["MM/dd/yyyy"];return t.forEach(a=>{try{if(q(a)){const e=this.decodeUrl(a);s.url=e;return}if(!isNaN(a)&&this.priorityOptionsValues.includes(parseFloat(a))){s.priority.label=s.priority.value=a;return}if(this.frequencyOptionsValues.includes(a.toLowerCase())){s.frequency.label=s.frequency.value=a.toLowerCase();return}r.forEach(e=>{I.fromFormat(a,e).isValid&&(s.lastModified=a)})}catch{}}),s.url!==null?s:!1},parseFile(){const t=new FileReader;return t.readAsText(this.file),new Promise((s,r)=>{t.onerror=()=>{t.abort(),r(new DOMException)},t.onload=()=>{const e=t.result.split(/[\r\n]/).map(i=>i.split(","));s(e)}})},handleFileUpload(){this.file=this.$refs.file.$el.querySelector("input").files[0],this.file&&(this.filename=this.file.name,this.file.type!=="text/csv"&&(this.errors.upload=this.strings.csvFileTypeRequired))},closeImportModal(){this.reset(),this.showImportModal=!1},isDisabledDate(t){return t>I.now()},downloadSampleCSV(){this.showDownloadSample=!1;const t=new Blob([this.sampleCSVData],{type:"text/csv"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download="aioseo-additional-pages-sample.csv",r.click()}},mounted(){this.priorityOptionsValues=O.map(t=>t.value),this.frequencyOptionsValues=F.map(t=>t.value),this.inTable&&(this.page=this.rowPage!==this.editedPage?this.rowPage:this.editedPage)}},ne={key:0,class:"page-input-header"},de={class:"page-url"},ge={class:"page-priority"},ue={class:"page-frequency"},ce={class:"page-last-modified"},pe={class:"page-row"},me={class:"page-url"},he={class:"append-icon"},fe={class:"page-priority"},Pe={class:"page-frequency"},ye={class:"page-last-modified"},_e={class:"page-input-footer"},be={key:0},ve={key:1},we={class:"aioseo-modal-body import-additional-pages"},Se={class:"alert"},ke=["innerHTML"],Ce=["src","alt"],De={class:"file-upload"};function Ue(t,s,r,a,e,i){const v=m("svg-circle-close"),w=m("svg-circle-check"),S=m("svg-circle-exclamation"),k=m("base-input"),C=m("core-alert"),D=m("base-select"),R=m("base-date-picker"),_=m("base-button"),f=m("core-modal");return P(),U("div",{class:V(["additional-pages-input",{"in-table":r.inTable}])},[r.inTable?y("",!0):(P(),U("div",ne,[l("div",de,n(e.strings.pageUrl),1),l("div",ge,n(e.strings.priority),1),l("div",ue,n(e.strings.frequency),1),l("div",ce,n(e.strings.lastModified),1)])),l("div",pe,[l("div",me,[u(k,{modelValue:e.page.url,onKeyup:s[0]||(s[0]=g=>i.editPage("url",g.target.value)),onInput:s[1]||(s[1]=g=>i.updateUrl(g.target.value)),size:"medium",placeholder:e.strings.placeholder,class:V(e.errors.url.invalid&&"aioseo-error"||e.page.url&&e.errors.url.exists&&"aioseo-warning"||e.page.url&&"aioseo-active")},{"append-icon":d(()=>[l("div",he,[e.isLoading?y("",!0):(P(),U(se,{key:0},[e.errors.url.invalid?(P(),b(v,{key:0})):y("",!0),!e.errors.url.invalid&&!e.errors.url.exists&&e.page.url?(P(),b(w,{key:1})):y("",!0),e.errors.url.exists&&e.page.url?(P(),b(S,{key:2})):y("",!0)],64))])]),_:1},8,["modelValue","placeholder","class"]),e.errors.url.invalid?(P(),b(C,{key:0,type:"red",size:"small"},{default:d(()=>[h(n(e.strings.errors.url.invalid),1)]),_:1})):y("",!0),e.errors.url.exists?(P(),b(C,{key:1,type:"yellow",size:"small"},{default:d(()=>[h(n(e.strings.errors.url.exists),1)]),_:1})):y("",!0)]),l("div",fe,[u(D,{size:"medium",modelValue:e.page.priority,"onUpdate:modelValue":s[2]||(s[2]=g=>i.editPage("priority",g)),options:a.PRIORITY_OPTIONS},null,8,["modelValue","options"])]),l("div",Pe,[u(D,{size:"medium",modelValue:e.page.frequency,"onUpdate:modelValue":s[3]||(s[3]=g=>i.editPage("frequency",g)),options:a.FREQUENCY_OPTIONS},null,8,["modelValue","options"])]),l("div",ye,[u(R,{type:"datetime",size:"large",dateFormat:"m/d/Y H:i:s",defaultValue:a.dateStringToLocalJs(e.page.lastModified),onChange:s[4]||(s[4]=g=>i.editPage("lastModified",a.dateJsToLocal(g,"MM/dd/yyyy HH:mm:ss"))),isDisabledDate:i.isDisabledDate},null,8,["defaultValue","isDisabledDate"])])]),l("div",_e,[r.inTable?(P(),U("div",be,[u(_,{type:"blue",size:"medium",onClick:s[5]||(s[5]=g=>i.updatePage(r.index)),disabled:e.errors.url.invalid||e.errors.url.exists||!e.page.url},{default:d(()=>[h(n(e.strings.saveChanges),1)]),_:1},8,["disabled"]),u(_,{type:"gray",size:"medium",onClick:s[6]||(s[6]=g=>t.$emit("cancel",!0))},{default:d(()=>[h(n(e.strings.cancel),1)]),_:1})])):y("",!0),r.inTable?y("",!0):(P(),U("div",ve,[u(_,{type:"blue",size:"small-table",onClick:i.addPage,disabled:e.errors.url.invalid||e.errors.url.exists||!e.page.url},{default:d(()=>[h(n(e.strings.addPage),1)]),_:1},8,["onClick","disabled"]),u(_,{type:"black",size:"small-table",onClick:s[7]||(s[7]=g=>e.showImportModal=!0)},{default:d(()=>[h(n(e.strings.importFromCSV),1)]),_:1})]))]),u(f,{show:e.showImportModal,onClose:i.closeImportModal,classes:["aioseo-add-additional-pages-modal"]},{headerTitle:d(()=>[h(n(e.strings.importAdditionalPages),1)]),body:d(()=>[l("div",we,[l("div",Se,[l("p",{innerHTML:e.strings.modalDescription},null,8,ke),l("a",{onClick:s[8]||(s[8]=L((...g)=>i.downloadSampleCSV&&i.downloadSampleCSV(...g),["stop"]))},n(e.strings.downloadSampleFile),1)]),l("img",{src:i.getAssetUrl(e.csvFileImage),alt:e.strings.imgAltText},null,8,Ce),e.errors.upload?(P(),b(C,{key:0,type:"red",class:"import-error"},{default:d(()=>[u(v),h(" "+n(e.errors.upload),1)]),_:1})):y("",!0),l("div",De,[u(k,{modelValue:e.filename,"onUpdate:modelValue":s[9]||(s[9]=g=>e.filename=g),size:"medium",onFocus:i.triggerFileUpload,placeholder:e.strings.fileUploadPlaceholder,class:V({"aioseo-error":e.errors.upload})},null,8,["modelValue","onFocus","placeholder","class"]),u(_,{type:"black",size:"medium",onClick:i.triggerFileUpload},{default:d(()=>[h(n(e.strings.chooseAFile),1)]),_:1},8,["onClick"])]),u(k,{type:"file",value:e.file,"onUpdate:modelValue":i.handleFileUpload,ref:"file"},null,8,["value","onUpdate:modelValue"]),u(_,{type:"blue",size:"medium",class:"import",onClick:i.submitFile,disabled:!e.file||!i.importValidated,loading:e.loading},{default:d(()=>[h(n(e.strings.import),1)]),_:1},8,["onClick","disabled","loading"])])]),_:1},8,["show","onClose"])],2)}const Le=B(re,[["render",Ue]]),p="all-in-one-seo-pack",Ae={setup(){const t="sitemap-additional-pages",{pageNumber:s,processChangeItemsPerPage:r,processPagination:a,processSort:e,resultsPerPage:i,searchTerm:v,wpTableKey:w,wpTableLoading:S}=W({changeItemsPerPageSlug:"sitemapAdditionalPages",fetchData:()=>Promise.resolve(),slug:"additionalPages",resultsPerPage:10,tableId:t});return{optionsStore:E(),pageNumber:s,processChangeItemsPerPage:r,processPagination:a,processSort:e,resultsPerPage:i,rootStore:z(),searchTerm:v,settingsStore:J(),tableId:t,wpTableKey:w,wpTableLoading:S}},components:{AddAdditionalPage:Le,CoreWpTable:te,CoreCard:ie,CoreTooltip:oe,CoreModal:Y,SvgTrash:ae},data(){return{page:{},editedPage:{},searchResults:null,deletingRow:!1,activeRow:-1,showDeleteModal:!1,shouldDeleteURL:null,selectedRows:null,bulkOptions:[{label:o("Delete",p),value:"delete"}],strings:{searchUrls:o("Search URLs",p),edit:o("Edit",p),delete:o("Delete",p),additionalPages:o("Additional Pages",p),additionalPagesTooltip:o("You can use this section to add any URLs to your sitemap which aren't a part of your WordPress installation. For example, if you have a contact form that you would like to be included on your sitemap you can enter the information manually.",p),areYouSureDeleteLink:o("Are you sure you want to delete this page?",p),areYouSureDeleteLinks:o("Are you sure you want to delete these pages?",p),thisWillRemoveLink:o("This will permanently remove this page from the additional pages sitemap.",p),thisWillRemoveLinks:o("This will permanently remove the selected pages from the additional pages sitemap.",p),yesDeleteLink:o("Delete Page",p),yesDeleteLinks:o("Delete selected pages",p),noChangedMind:o("No, I changed my mind",p)}}},computed:{currentPages(){return this.searchResults||this.getParsedPages()},rows(){const t=this.currentPages.map(r=>({url:r.url,priority:r.priority&&r.priority.label?r.priority.label:"",frequency:r.frequency&&r.frequency.label?r.frequency.label:"",lastModified:r.lastModified})),s=this.pageNumber===1?0:(this.pageNumber-1)*this.resultsPerPage;return t.slice(s,s+this.resultsPerPage)},totals(){return{page:1,pages:Math.ceil(this.currentPages.length/this.resultsPerPage),total:this.currentPages.length}},columns(){return[{slug:"url",label:o("Page URL",p)},{slug:"priority",label:o("Priority",p),width:"90px"},{slug:"frequency",label:o("Frequency",p),width:"90px"},{slug:"lastModified",label:o("Last Modified",p),width:"180px"},{slug:"page-actions",label:"",width:"40px"}]},areYouSureDeleteLink(){return Array.isArray(this.shouldDeleteURL)&&1<this.shouldDeleteURL.length?this.strings.areYouSureDeleteLinks:this.strings.areYouSureDeleteLink},yesDeleteLink(){return Array.isArray(this.shouldDeleteURL)&&1<this.shouldDeleteURL.length?this.strings.yesDeleteLinks:this.strings.yesDeleteLink},thisWillRemoveLink(){return Array.isArray(this.shouldDeleteURL)&&1<this.shouldDeleteURL.length?this.strings.thisWillRemoveLinks:this.strings.thisWillRemoveLink}},methods:{processSearch(t){if(this.$refs.table.editRow(null),this.pageNumber=1,t===""){this.searchResults=null,this.searchTerm=null;return}t||(t=this.searchTerm),this.wpTableLoading=!0,this.searchResults=this.getParsedPages().filter(s=>s.url.includes(t)),this.searchTerm=t,this.wpTableLoading=!1},processBulkAction({action:t,selectedRows:s}){s.length&&t==="delete"&&(this.showDeleteModal=!0,this.shouldDeleteURL=s)},processPageDelete(){this.wpTableLoading=!0,Array.isArray(this.shouldDeleteURL)?this.shouldDeleteURL.forEach(t=>{this.deletePage(t)}):this.deletePage(this.shouldDeleteURL),this.showDeleteModal=!1,this.wpTableLoading=!1},deletePage(t){const s=[];this.getParsedPages().forEach(r=>{r.url!==t&&s.push(JSON.stringify(r))}),this.optionsStore.options.sitemap.general.additionalPages.pages=s,this.searchResults&&this.processSearch()},maybeProcessDelete(t){this.showDeleteModal=!0,this.shouldDeleteURL=t},processPageEdit(t){this.editedPage=t},processPageAddAndUpdate(){this.processSearch(this.searchTerm||"")},rowPage(t){return this.searchResults?this.searchResults[this.getPaginatedIndex(t)]:this.getParsedPages()[this.getPaginatedIndex(t)]},getPaginatedIndex(t){return(this.pageNumber-1)*this.resultsPerPage+t},getParsedPages(){return this.optionsStore.options.sitemap.general.additionalPages.pages.map(t=>JSON.parse(t))}}},xe={class:"aioseo-additional-pages"},Re=["onClick"],Te={class:"row-actions"},Ve=["onClick"],Ie=["onClick"],Me={class:"page-actions"},Fe={class:"aioseo-modal-body delete"},Oe={class:"reset-description"};function qe(t,s,r,a,e,i){const v=m("base-toggle"),w=m("add-additional-page"),S=m("svg-trash"),k=m("core-tooltip"),C=m("core-wp-table"),D=m("base-button"),R=m("core-modal"),_=m("core-card");return a.optionsStore.options.sitemap.general.enable?(P(),b(_,{key:0,slug:"additionalPages",toggles:a.optionsStore.options.sitemap.general.additionalPages.enable},{header:d(()=>[u(v,{modelValue:a.optionsStore.options.sitemap.general.additionalPages.enable,"onUpdate:modelValue":s[0]||(s[0]=f=>a.optionsStore.options.sitemap.general.additionalPages.enable=f)},null,8,["modelValue"]),l("span",null,n(e.strings.additionalPages),1)]),tooltip:d(()=>[h(n(e.strings.additionalPagesTooltip),1)]),default:d(()=>[l("div",xe,[u(w,{getPaginatedIndex:i.getPaginatedIndex,getParsedPages:i.getParsedPages,onProcessPageAddAndUpdate:i.processPageAddAndUpdate},null,8,["getPaginatedIndex","getParsedPages","onProcessPageAddAndUpdate"]),(P(),b(C,{ref:"table",class:"additional-pages-table",id:a.tableId,"bulk-options":e.bulkOptions,columns:i.columns,"initial-items-per-page":a.settingsStore.settings.tablePagination.sitemapAdditionalPages,"initial-page-number":a.pageNumber,key:a.wpTableKey,loading:a.wpTableLoading,rows:i.rows,"search-label":e.strings.searchUrls,"show-search":!0,totals:i.totals,"reset-selection":!1,"show-items-per-page":"",onPaginate:a.processPagination,onProcessBulkAction:i.processBulkAction,onProcessChangeItemsPerPage:a.processChangeItemsPerPage,onSearch:i.processSearch,onSortColumn:a.processSort},{url:d(({row:f,index:g,editRow:T})=>[l("a",{class:"post-title",href:"#",onClick:L(M=>T(g),["prevent","stop"])},n(f.url),9,Re),l("div",Te,[l("span",null,[l("a",{class:"edit",href:"#",onClick:L(M=>T(g),["prevent","stop"])},[l("span",null,n(e.strings.edit),1)],8,Ve),h(" | ")]),l("span",null,[l("a",{class:"delete",href:"#",onClick:L(M=>i.maybeProcessDelete(f.url),["prevent","stop"])},[l("span",null,n(e.strings.delete),1)],8,Ie)])])]),"edit-row":d(({index:f,editRow:g})=>[u(w,{index:f,rowPage:i.rowPage(f),editedPage:e.editedPage,getPaginatedIndex:i.getPaginatedIndex,getParsedPages:i.getParsedPages,inTable:"",onCancel:T=>g(null),onProcessPageAddAndUpdate:i.processPageAddAndUpdate,onProcessPageEdit:i.processPageEdit},null,8,["index","rowPage","editedPage","getPaginatedIndex","getParsedPages","onCancel","onProcessPageAddAndUpdate","onProcessPageEdit"])]),"page-actions":d(({row:f})=>[l("div",Me,[u(k,{type:"action"},{tooltip:d(()=>[h(n(e.strings.delete),1)]),default:d(()=>[u(S,{onClick:g=>i.maybeProcessDelete(f.url)},null,8,["onClick"])]),_:2},1024)])]),_:1},8,["id","bulk-options","columns","initial-items-per-page","initial-page-number","loading","rows","search-label","totals","onPaginate","onProcessBulkAction","onProcessChangeItemsPerPage","onSearch","onSortColumn"])),u(R,{show:e.showDeleteModal,"no-header":"",onClose:s[3]||(s[3]=f=>e.showDeleteModal=!1),classes:["aioseo-additional-pages-modal"]},{body:d(()=>[l("div",Fe,[l("button",{class:"close",onClick:s[1]||(s[1]=L(f=>e.showDeleteModal=!1,["stop"]))}),l("h3",null,n(i.areYouSureDeleteLink),1),l("div",Oe,n(e.strings.thisWillRemoveLink),1),u(D,{type:"blue",size:"medium",onClick:i.processPageDelete,loading:e.deletingRow},{default:d(()=>[h(n(i.yesDeleteLink),1)]),_:1},8,["onClick","loading"]),u(D,{type:"gray",size:"medium",onClick:s[2]||(s[2]=f=>e.showDeleteModal=!1)},{default:d(()=>[h(n(e.strings.noChangedMind),1)]),_:1})])]),_:1},8,["show"])])]),_:1},8,["toggles"])):y("",!0)}const bs=B(Ae,[["render",qe]]);export{bs as default};
