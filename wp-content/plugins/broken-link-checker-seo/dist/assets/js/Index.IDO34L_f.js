import{d as S,u as x,b as A,m as L,_ as t,s as u}from"./index.DSqmL29l.js";import{u as w,p as W}from"./LicenseUpgrade.BsG_D8qF.js";import{a as P,u as E}from"./SetupWizard.DJpWJQun.js";import{C as B,D as v}from"./datetime.BBR3Qyzf.js";import{_ as T}from"./Button.DPCVwz2Z.js";import{_ as y}from"./_plugin-vue_export-helper.BN1snXvA.js";import{o as l,c as d,g as s,a as g,w as m,j as p,t as c,h as z,d as k,l as N,n as O,r as _}from"./runtime-dom.esm-bundler.B6m80oiY.js";import{u as M}from"./LicenseStore._Dzt6Lww.js";const F={},U={viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"aioseo-circle-check-solid"},q=s("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.75 10.5C1.75 5.67 5.67 1.75 10.5 1.75C15.33 1.75 19.25 5.67 19.25 10.5C19.25 15.33 15.33 19.25 10.5 19.25C5.67 19.25 1.75 15.33 1.75 10.5ZM8.75 12.3988L14.5163 6.63251L15.75 7.87501L8.75 14.875L5.25 11.375L6.48375 10.1413L8.75 12.3988Z",fill:"currentColor"},null,-1),D=[q];function K(e,o){return l(),d("svg",U,D)}const R=y(F,[["render",K]]),n="broken-link-checker-seo",Y={setup(){return{licenseStore:M(),licenseUpgradeComposable:w(),links:S,optionsStore:x(),rootStore:A(),setupWizardComposable:P(),setupWizardStore:E()}},components:{BaseButton:T,CoreAlert:B,SvgCircleCheckSolid:R},props:{isSetupWizard:Boolean},data(){return{DateTime:v,licenseKey:"",error:null,creatingNewAccount:!1,connectingWithExistingAccount:!1,activating:!1,deactivating:!1,strings:L({createAccount:t("Create a Free Account",n),connectExistingAccount:t("Connect to an Existing Account",n),or:t("OR",n),boldText:u("<strong>%1$s %2$s</strong>","Broken Link Checker","Free"),disconnect:t("Disconnect",n),connected:t("Your account is connected!",n)},this.licenseUpgradeComposable.strings,this.setupWizardComposable.strings)}},computed:{link(){return u('<strong><a href="%1$s" target="_blank">%2$s</a></strong>',this.links.utmUrl("general-settings","license-box"),this.strings.linkText)},tooltipText(){return u(t("To unlock a higher quota, consider %1$s.",n),this.link)},licenseInfo(){const e=v.fromMillis(this.optionsStore.internalOptions.internal.license.expires*1e3);if(3e3<=e.year)return u(t("You have a total quota of %1$s links (%2$s remaining). Your free subscription resets each month.",n),`<strong>${this.optionsStore.internalOptions.internal.license.quota.toLocaleString()}</strong>`,`${this.optionsStore.internalOptions.internal.license.quotaRemaining.toLocaleString()}`,`<strong>${t("Free Forever",n)}</strong>`);const a=e.toFormat("MM/dd/yyyy");return u(t("You have a total quota of %1$s links (%2$s remaining), which renews on %3$s.",n),`<strong>${this.optionsStore.internalOptions.internal.license.quota.toLocaleString()}</strong>`,`${this.optionsStore.internalOptions.internal.license.quotaRemaining.toLocaleString()}`,`<strong>${a}</strong>`)}},methods:{createNewAccountPopup(){this.creatingNewAccount=!0;const e=this.rootStore.aioseoBrokenLinkChecker.urls.marketingSite+"blc-trial-checkout?url="+btoa(this.rootStore.aioseoBrokenLinkChecker.urls.connect);this.openPopup(e)},connectWithExistingAccountPopup(){this.connectingWithExistingAccount=!0;const e=this.rootStore.aioseoBrokenLinkChecker.urls.marketingSite+"account/?blc-connect=1&url="+btoa(this.rootStore.aioseoBrokenLinkChecker.urls.connect);this.openPopup(e)},openPopup(e){W(e,t("Connect Your Site with Broken Link Checker",n),650,800,!0,["token"],this.completedCallback,this.closedCallback)},completedCallback(e){if(!e.token){this.creatingNewAccount=!1,this.connectingWithExistingAccount=!1,this.error=t("Could not connect site to Broken Link Checker. Please try again later.",n);return}return this.licenseKey=e.token,this.activate(),Promise.resolve()},closedCallback(){this.activating||(this.creatingNewAccount=!1,this.connectingWithExistingAccount=!1)},activate(){return this.error=null,this.activating=!0,this.licenseStore.activate(this.licenseKey).then(()=>{this.isSetupWizard&&this.$router.push(this.setupWizardStore.getNextLink)}).catch(e=>{var a,r;if(this.licenseKey="",!((r=(a=e==null?void 0:e.response)==null?void 0:a.body)!=null&&r.error)||!e.response.body.licenseData){this.error=t("An unknown error occurred, please try again later.",n);return}const o=e.response.body.licenseData;o.invalid?this.error=t("The license key provided is invalid. Please use a different key.",n):o.disabled?this.error=t("The license key provided is disabled. Please use a different key.",n):o.expired?this.error=t("The license key provided is expired. Please renew your license or use a different key.",n):o.activationsError?this.error=t("This license has reached the maximum number of activations. Please deactivate it from another site or purchase a new license.",n):(o.connectionError||o.requestError)&&(this.error=t("There was an error connecting to the licensing API. Please try again later.",n)),this.error=t("An unknown error occurred, please try again later.",n)}).finally(()=>{this.activating=!1,this.creatingNewAccount=!1,this.connectingWithExistingAccount=!1})},disconnect(){this.deactivating=!0,this.licenseStore.deactivate().catch(()=>{this.error=t("An unknown error occurred, please try again later.",n)}).finally(()=>{this.deactivating=!1})}}},H={key:0,class:"connect-buttons"},V={class:"button-divider description"},$={key:1},I={class:"license"},Z={class:"license-buttons"},j={class:"account-connected"},G={class:"license-info"},J=["innerHTML"],Q={key:0};function X(e,o,a,r,i,h){const f=_("base-button"),C=_("core-alert"),b=_("svg-circle-check-solid");return l(),d("div",{class:O(["license-container",[{"setup-wizard":a.isSetupWizard}]])},[r.optionsStore.internalOptions.internal.license.licenseKey?k("",!0):(l(),d("div",H,[g(f,{type:"green",size:"medium",inline:"",tag:"button",loading:i.creatingNewAccount,disabled:i.connectingWithExistingAccount,onClick:h.createNewAccountPopup},{default:m(()=>[p(c(i.strings.createAccount),1)]),_:1},8,["loading","disabled","onClick"]),s("div",V,c(i.strings.or),1),g(f,{type:"gray",size:"medium",inline:"",tag:"button",loading:i.connectingWithExistingAccount,disabled:i.creatingNewAccount,onClick:h.connectWithExistingAccountPopup},{default:m(()=>[p(c(i.strings.connectExistingAccount),1)]),_:1},8,["loading","disabled","onClick"]),i.error?(l(),z(C,{key:0,class:"license-key-error",type:"red",innerHTML:i.error},null,8,["innerHTML"])):k("",!0)])),r.optionsStore.internalOptions.internal.license.licenseKey?(l(),d("div",$,[s("div",I,[s("div",Z,[s("div",j,[g(b),p(" "+c(i.strings.connected),1)]),g(f,{type:"gray",size:"medium",inline:"",tag:"button",loading:i.deactivating,onClick:h.disconnect},{default:m(()=>[p(c(i.strings.disconnect),1)]),_:1},8,["loading","onClick"])]),s("div",G,[s("p",{innerHTML:h.licenseInfo},null,8,J),r.optionsStore.internalOptions.internal.license.level&&r.optionsStore.internalOptions.internal.license.level.toLowerCase()!=="elite"?(l(),d("p",Q,[s("span",null,c(i.strings.toUnlock)+"Â ",1),s("strong",null,[s("a",{href:"#",onClick:o[0]||(o[0]=N(ee=>r.licenseUpgradeComposable.openLicenseUpgradePopup("settings","license-key"),["prevent","stop"]))},c(r.licenseUpgradeComposable.upgradeAnchor.value),1)]),p(". ")])):k("",!0)])])])):k("",!0)],2)}const le=y(Y,[["render",X]]);export{le as C};
