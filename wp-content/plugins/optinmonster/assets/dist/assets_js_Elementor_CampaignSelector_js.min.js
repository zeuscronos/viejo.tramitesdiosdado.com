"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkoptin_monster_wp_api"] = self["webpackChunkoptin_monster_wp_api"] || []).push([["assets_js_Elementor_CampaignSelector_js"],{

/***/ "./assets/js/Elementor/CampaignSelector.js":
/*!*************************************************!*\
  !*** ./assets/js/Elementor/CampaignSelector.js ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ \"./node_modules/@babel/runtime/helpers/esm/defineProperty.js\");\n/* harmony import */ var _Utils_campaigns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Utils/campaigns */ \"./assets/js/Utils/campaigns.js\");\n\n\nconst removed = [];\nOMAPI._usedSlugs = OMAPI._usedSlugs || {};\nclass CampaignSelector extends elementorModules.frontend.handlers.Base {\n  getDefaultSettings() {\n    return {\n      selectors: {\n        holder: '.om-elementor-editor .om-elementor-holder',\n        select: '.om-elementor-editor select',\n        links: '.om-elementor-editor a'\n      }\n    };\n  }\n  getDefaultElements() {\n    const selectors = this.getSettings('selectors');\n    return {\n      $holder: this.$element.find(selectors.holder),\n      $select: this.$element.find(selectors.select),\n      $links: this.$element.find(selectors.links)\n    };\n  }\n  bindEvents() {\n    window.OMAPI_Elementor.instances.push(this);\n    this.oldSlug = this.campaignSlug();\n    this.campaignLoaded = false;\n    this.on('campaignLoaded', () => {\n      this.campaignLoaded = true;\n      this.$element.find('.om-elementor-editor .om-errors').hide();\n    });\n    this.on('otherCampaignLoaded', this.updateSelect.bind(this));\n    this.on('otherCampaignRemoved', this.updateSelect.bind(this));\n    this.on('campaignError', this.foundError.bind(this));\n    this.elements.$select.on('change', this.onSelect.bind(this));\n    this.elements.$links.on('click', this.onClickLinks.bind(this));\n    this.initCampaignPreview();\n    this.maybeTogglePanelSettings();\n  }\n  unbindEvents() {\n    const campaign = this.getCampaign();\n    if (campaign) {\n      removed.push(campaign);\n      campaign.off();\n    }\n    if (this.oldSlug) {\n      delete OMAPI._usedSlugs[this.oldSlug];\n      window.OMAPI_Elementor.utils.events.trigger(document, 'Plugin.Elementor.Instance.removed', {\n        id: this.oldSlug\n      });\n    }\n  }\n\n  /**\n   * Handles get-campaigns error.\n   *\n   * @2.2.0\n   *\n   * @param  {Object} error Error event object\n   *\n   * @returns {void}\n   */\n  foundError(error) {\n    const slug = this.campaignSlug();\n    if (error.responseURL && 0 > error.responseURL.indexOf(slug)) {\n      return;\n    }\n    let msg = error;\n    if (error.response) {\n      msg = JSON.parse(error.response).message || JSON.parse(error.response).error;\n    }\n    if (error.message) {\n      msg = error.message;\n    }\n    this.$element.find('.om-elementor-editor .om-errors').show().find('.om-error-description').html(msg);\n  }\n  onClickLinks(event) {\n    event.preventDefault();\n    window.open(event.target.href);\n  }\n  onSelect(event) {\n    event.preventDefault();\n    const $select = window.parent.jQuery('#elementor-controls .elementor-control-campaign_id select[data-setting=\"campaign_id\"]');\n    $select.val(this.elements.$select.val()).trigger('change');\n  }\n  onElementChange(propertyName, controlView, elementView) {\n    const $editorSelect = controlView.$el.find('select[data-setting=\"campaign_id\"]');\n    if ($editorSelect.length) {\n      CampaignSelector.$editorSelect = $editorSelect;\n    }\n    this.maybeTogglePanelSettings();\n    if ('campaign_id' === propertyName) {\n      this.initCampaignPreview();\n    }\n  }\n  initCampaignPreview() {\n    this.initCampaign();\n    this.updateSelect();\n  }\n  initCampaign() {\n    const slug = this.campaignSlug();\n    if (!slug) {\n      return;\n    }\n    if (this.oldSlug) {\n      delete OMAPI._usedSlugs[this.oldSlug];\n    }\n    this.oldSlug = slug;\n    OMAPI._usedSlugs[slug] = true;\n    this.elements.$holder.html(`<div id=\"om-${slug}-holder\"></div>`);\n    let campaign = this.getCampaign();\n    if (campaign) {\n      return;\n    }\n    if (removed.length) {\n      campaign = removed.find(c => slug === c.id);\n      if (campaign) {\n        removed.splice(removed.indexOf(campaign), 1);\n        return setTimeout(() => campaign.reset(), 200);\n      }\n    }\n    if (campaign) {\n      return;\n    }\n    const embed = {\n      id: `om-${slug}-js`,\n      type: 'text/javascript',\n      src: OMAPI.apiUrl,\n      async: true,\n      'data-user': OMAPI.omUserId,\n      'data-campaign': slug\n    };\n    if (OMAPI.omEnv) {\n      embed['data-env'] = OMAPI.omEnv;\n    }\n\n    // Attempt to append it to the <head>, otherwise append to the document.\n    const head = document.getElementsByTagName('head')[0] || document.documentElement;\n    const newScript = document.createElement('script');\n    let att;\n    for (att in embed) {\n      newScript.setAttribute(att, embed[att]);\n    }\n    head.appendChild(newScript);\n  }\n  updateSelect() {\n    this.updateSelectOptions(this.elements.$select);\n  }\n  updateSelectOptions($select) {\n    const slug = this.campaignSlug();\n    const fragment = document.createDocumentFragment();\n    $select.find('option').remove();\n    (0,_Utils_campaigns__WEBPACK_IMPORTED_MODULE_1__.getOptions)('inline', slug).forEach(o => {\n      const option = document.createElement('option');\n      option.textContent = o.label;\n      option.value = o.value;\n      if (o.selected) {\n        option.selected = true;\n      }\n      if (o.disabled) {\n        option.disabled = true;\n      }\n      fragment.appendChild(option);\n    });\n    $select.append(fragment);\n  }\n\n  /**\n   * Get the campaign slug from element settings.\n   *\n   * @since  2.2.0\n   *\n   * @returns {string} Campaign slug.\n   */\n  campaignSlug() {\n    const slug = this.getElementSettings('campaign_id');\n    // Sanitize to numbers/letters only.\n    return slug.replace(/[^a-zA-Z0-9]/g, '');\n  }\n\n  /**\n   * Get the global campaign object from OM API.\n   *\n   * @since  2.2.0\n   *\n   * @returns {Object|null} The global campaign object or null.\n   */\n  getCampaign() {\n    return (0,_Utils_campaigns__WEBPACK_IMPORTED_MODULE_1__.getCampaign)(this.campaignSlug());\n  }\n\n  /**\n   * Called from parent classs.\n   *\n   * @since  2.2.0\n   *\n   * @param  {string} changed The thing that changed.\n   *\n   * @returns {void}\n   */\n  onEditSettingsChange(changed) {\n    if ('panel' === changed) {\n      this.maybeTogglePanelSettings();\n    }\n  }\n  maybeTogglePanelSettings() {\n    setTimeout(() => {\n      const page = elementor.getPanelView().getCurrentPageView();\n      const slug = this.campaignSlug();\n      if (page.getControlViewByName) {\n        ['edit_campaign', 'followrules', 'campaign_id'].forEach(k => {\n          const model = page.getControlModel(k);\n          if (!model) {\n            return;\n          }\n          const view = page.getControlViewByModel(model);\n          if (!view) {\n            return;\n          }\n          if ('campaign_id' === k) {\n            const $select = view.$el.find('[data-setting=\"campaign_id\"]');\n            if ($select.length) {\n              this.updateSelectOptions($select);\n            }\n          } else {\n            // Toggle these controls from view.\n            view.$el[slug ? 'show' : 'hide']();\n          }\n          if (slug && 'edit_campaign' === k) {\n            const $link = view.$el.find('a');\n            if ($link.length) {\n              $link.attr('href', OMAPI.editUrl.replace(/--CAMPAIGN_SLUG--/g, slug));\n            }\n          }\n        });\n      }\n    }, 10);\n  }\n}\n(0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(CampaignSelector, \"$editorSelect\", null);\n/* harmony default export */ __webpack_exports__[\"default\"] = (CampaignSelector);\n\n//# sourceURL=webpack://optin-monster-wp-api/./assets/js/Elementor/CampaignSelector.js?\n}");

/***/ }),

/***/ "./assets/js/Utils/campaigns.js":
/*!**************************************!*\
  !*** ./assets/js/Utils/campaigns.js ***!
  \**************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCampaign: function() { return /* binding */ getCampaign; },\n/* harmony export */   getOptions: function() { return /* binding */ getOptions; }\n/* harmony export */ });\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! lodash/get */ \"./node_modules/lodash/get.js\");\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _sites__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sites */ \"./assets/js/Utils/sites.js\");\n\n\n\n/**\n * Get available inline campaign select options.\n *\n * @since  [since]\n *\n * @param  {string}  type       The campaign generic type (inline or other).\n * @param  {string}  slug       The campaign slug.\n * @param  {boolean} checkSites Whether to check for sites (return empty result if no sites connected).\n *\n * @returns {Array}              Array of campaign options for select elements.\n *                              Includes value, label, and selected/disabled properties.\n */\nconst getOptions = function (type) {\n  let slug = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let checkSites = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  if (checkSites && !(0,_sites__WEBPACK_IMPORTED_MODULE_1__.hasSites)()) {\n    return [];\n  }\n  const campaigns = lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(OMAPI, `campaigns.${type}`, {});\n  if (Object.keys(campaigns).length < 1 || !OMAPI.omUserId) {\n    return [];\n  }\n  let available = Object.keys(campaigns).map(value => {\n    let label = lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(campaigns, `${value}.title`, '');\n    if (lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(campaigns, `${value}.pending`)) {\n      label += ' [Pending]';\n    }\n    const selected = null !== slug && slug === value;\n    const disabled = null !== slug && lodash_get__WEBPACK_IMPORTED_MODULE_0___default()(OMAPI, `_usedSlugs.${value}`) && value !== slug;\n    return {\n      value,\n      label,\n      selected,\n      disabled\n    };\n  });\n  if (available.length > 0) {\n    available.unshift({\n      value: '',\n      label: OMAPI.i18n.campaign_select\n    });\n  }\n  return available;\n};\n\n/**\n * Get the global campaign object from OM API for given slug.\n *\n * @since 2.3.0\n *\n * @param  {string} slug The campaign slug.\n *\n * @returns {Object|null} The global campaign object or null.\n */\nconst getCampaign = function () {\n  let slug = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  const key = `om${slug}`;\n  return window[key] ? window[key] : null;\n};\n\n//# sourceURL=webpack://optin-monster-wp-api/./assets/js/Utils/campaigns.js?\n}");

/***/ }),

/***/ "./assets/js/Utils/sites.js":
/*!**********************************!*\
  !*** ./assets/js/Utils/sites.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   hasSites: function() { return /* binding */ hasSites; }\n/* harmony export */ });\nconst hasSites = () => OMAPI.site_ids && OMAPI.site_ids.length > 0;\n\n//# sourceURL=webpack://optin-monster-wp-api/./assets/js/Utils/sites.js?\n}");

/***/ })

}]);