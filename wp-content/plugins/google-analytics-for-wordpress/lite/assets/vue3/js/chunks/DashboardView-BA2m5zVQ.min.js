import{s as a,h as e,o as t,x as s,k as o,d as i,c as n,a as l,e as d,f as r,b as u,g as c,u as h,n as p,t as m,_ as v}from"../custom-dashboard.min.js";import{u as g,a as w,c as f,V as b,_ as y,b as S,e as D,A as V,R as x,f as O}from"./useAuthGate-DLbsgrl4.min.js";import{u as C,a as _,U as A}from"./useSampleData-B2hwwtwo.min.js";const E={class:"monsterinsights-dashboard-view","data-html2canvas-ignore":"true"},L={class:"monsterinsights-dashboard-main-content"},M={class:"monsterinsights-page-header"},j={"data-html2canvas-ignore":"true"},T=["title"],k={__name:"DashboardView",setup(k){const R=i(),U=s(),B=g(),{hasAccess:I,isSampleMode:P,shouldBlurContent:F,shouldShowUpsell:G,upsellContent:N,hasSampleData:q,openUpsellModal:z,closeUpsellModal:H,enableSampleMode:J}=C("custom-dashboard"),{isAuthenticated:K,showAuthModal:Q,showReAuthModal:W,shouldBlurContent:X,openAuthModal:Y,closeAuthModal:Z}=w(),{sampleData:$,loadSampleData:aa}=_("custom-dashboard","widgets-data"),{sampleData:ea,loadSampleData:ta}=_("custom-dashboard","sample-view"),sa=a([]),oa=a({}),ia=a({}),na=a(function(){const a=new Date,e=new Date;return e.setDate(e.getDate()-30),{start:e.toISOString().split("T")[0],end:a.toISOString().split("T")[0],compareStart:"",compareEnd:"",interval:"last30days",compareReport:!1,text:"",compareText:"",intervalText:"",intervalCompareText:""}}()),la=e(()=>{var a;return P.value&&(null==(a=ea.value)?void 0:a[0])?ea.value[0]:B.currentView}),da=e(()=>P.value&&ea.value?ea.value:B.allViews),ra=e({get:()=>na,set(a){Object.assign(na,a)}}),ua=e(()=>{var a;return!P.value&&I.value||!(null==(a=$.value)?void 0:a.widgets)?oa:$.value.widgets}),ca=e(()=>B.isLoading);async function ha(){var a,e;if(J(),null==(e=null==(a=ea.value)?void 0:a[0])?void 0:e.layout){sa.length=0;const a=[...ea.value[0].layout].sort((a,e)=>3*a.position.y+a.position.x-(3*e.position.y+e.position.x));sa.push(...a)}}async function pa(a){var e,t;if(a){B.setLoading(!0);try{if(sa.length=0,Object.keys(oa).forEach(a=>delete oa[a]),Object.keys(ia).forEach(a=>delete ia[a]),await B.loadViewForViewing(a),!(null==(t=null==(e=B.currentView)?void 0:e.layout)?void 0:t.length))return B.setLoading(!1),void R.push({name:"dashboard-edit",params:{id:a}});const s=[...B.currentView.layout].sort((a,e)=>3*a.position.y+a.position.x-(3*e.position.y+e.position.x));sa.push(...s),await ma()}catch(s){B.setLoading(!1)}}}async function ma(){var a,e;if(!sa.length)return;const t=[];for(let o=0;o<sa.length;o+=5)t.push(sa.slice(o,o+5));B.setLoading(!0),sa.forEach(a=>{a&&a.id&&(ia[a.id]=!0)});for(let o=0;o<t.length;o++){const i=t[o];try{const t=await f.getDashboardData(i,na),s=(null==(a=null==t?void 0:t.data)?void 0:a.widgets)||(null==t?void 0:t.widgets),o=(null==(e=null==t?void 0:t.data)?void 0:e.date_range)||(null==t?void 0:t.date_range);s&&Object.keys(s).forEach(a=>{oa[a]={...s[a],dateRange:o?{current:{start:o.start,end:o.end},previous:{start:o.compareStart||"",end:o.compareEnd||""}}:null}})}catch(s){i.forEach(a=>{a&&a.id&&(oa[a.id]={error:!0,message:s.message})})}finally{i.forEach(a=>{a&&a.id&&(ia[a.id]=!1)})}o<t.length-1&&await new Promise(a=>setTimeout(a,300))}B.setLoading(!1)}async function va(){await ma()}function ga(a){"new"===a?R.push({name:"dashboard-create"}):R.push({name:"dashboard-view",params:{id:a}})}function wa(){I.value?R.push({name:"dashboard-add"}):z()}async function fa(a){try{await B.deleteView(a),B.allViews.length>0?R.push({name:"dashboard-view",params:{id:B.allViews[0].id}}):R.push({name:"dashboard-list"})}catch(e){}}function ba({id:a}){R.push({name:"dashboard-edit",params:{id:a}})}function ya(a){R.push({name:"dashboard-edit",params:{id:a}})}return t(async()=>{if(I.value||(await async function(){var a,e;if(await Promise.all([aa(),ta()]),null==(e=null==(a=ea.value)?void 0:a[0])?void 0:e.layout){sa.length=0;const a=[...ea.value[0].layout].sort((a,e)=>3*a.position.y+a.position.x-(3*e.position.y+e.position.x));sa.push(...a)}}(),"sample"==U.params.id&&J()),K.value)if(I.value){B.setLoading(!0);try{await B.loadViews(),await pa(U.params.id)}catch(a){B.setLoading(!1)}}else z();else Y()}),o(()=>U.params.id,(a,e)=>{a!==e&&pa(a)}),(a,e)=>{var t,s;return l(),n("div",E,[h(P)?(l(),d(O,{key:0,feature:"custom-dashboard"})):r("",!0),u(b,{"all-views":da.value,"current-view":la.value,"auto-save-status":"saved","is-new-view":!1,onSelect:ga,onRename:ba,onDelete:fa,onAddNew:wa,onEdit:ya},null,8,["all-views","current-view"]),c("div",L,[c("div",{class:p(["monsterinsights-dashboard-main",{"monsterinsights-content-blurred":h(F)||h(X)}])},[c("div",M,[c("h1",j,m((null==(t=la.value)?void 0:t.title)||h(v)("Dashboard","google-analytics-for-wordpress")),1),c("div",{class:p(["monsterinsights-page-header__actions",{"monsterinsights-page-header__actions--disabled":ca.value}]),title:ca.value?h(v)("Please wait while data is loading...","google-analytics-for-wordpress"):"","data-html2canvas-ignore":"true"},[u(y,{"report-title":null==(s=la.value)?void 0:s.title,disabled:ca.value},null,8,["report-title","disabled"]),u(h(S),{modelValue:ra.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ra.value=a),disabled:ca.value,onDateChanged:va},null,8,["modelValue","disabled"])],10,T)]),u(D,{widgets:sa,"widget-data":ua.value,"widget-loading-states":ia,"is-draggable":!1,"is-editable":!1},null,8,["widgets","widget-data","widget-loading-states"])],2)]),u(V,{isOpen:h(Q),onClose:h(Z)},null,8,["isOpen","onClose"]),u(x,{isOpen:h(W),onClose:h(Z)},null,8,["isOpen","onClose"]),u(A,{isOpen:h(G),feature:"custom-dashboard",dismissible:!1,content:h(N),showSampleButton:h(q),customImage:"sample-image-monsterinsights.png",onClose:h(H),onSeeSample:ha},null,8,["isOpen","content","showSampleButton","onClose"])])}}};export{k as default};
